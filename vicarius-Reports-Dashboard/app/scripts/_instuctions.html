<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Instructions for Using VickyTopiaReportCLI.py Script</title>
</head>
<body>

  <h1>Instructions for Using VickyTopiaReportCLI.py Script</h1>

  <hr>

  <h2>PREREQUISITES</h2>

  <p>Ensure that you have Python installed on your system.</p>

  <ol>
    <li>Open a command prompt or terminal window</li>
    <li>Navigate to the directory where the scripts are saved using the <code>cd</code> command.</li>
    <li>Install the required dependencies for the scripts by running the following commands:</li>
  </ol>

  <pre>
    <code>pip install requests</code>
    <code>pip install pandas</code>
    <code>pip install tqdm</code>
  </pre>

  <hr>

  <h2>RUN THE SCRIPT VickyTopiaReportCLI.py</h2>

  <p>Run the VickyTopiaReportCLI.py script using the following command:</p>

  <pre>
    <code>python VickyTopiaReportCLI.py -k YOUR_API_KEY -d https://xxxx.vicarius.cloud --allreports</code>
  </pre>

  <p>Replace <code>YOUR_API_KEY</code> with your actual Topia API key and <code>https://xxxx.vicarius.cloud</code> with your dashboard URL.</p>

  <h3>Available Options</h3>

  <p><strong>state.json file</strong></p>

  <p>Set "lastEndpointsEventTask": &lt;date in epoch nanoseconds&gt; for minimum Task event date record to query.</p>
  <p>Set "minDateIncidentEventVulnerabilities": &lt;date in epoch nanoseconds&gt;, for minimum Incident event date record to query.</p>

  <ul>
    <li><code>-k</code> or <code>--api-key</code>: Specify the Topia API key.</li>
    <li><code>-d</code> or <code>--dashboard</code>: Specify the URL of the Topia dashboard.</li>
    <li><code>--allreports</code>: Retrieve all available reports.</li>
  </ul>

  <p>Run each report in the following order:</p>

  <ul>
    <li><code>-r</code> or <code>--resetstate</code>: Trigger a reset of the state.</li>
    <li><code>-a</code> or <code>--assetsreport</code>: Retrieve assets reports.</li>
    <li><code>-t</code> or <code>--taskreport</code>: Retrieve task reports.</li>
    <li><code>-v</code> or <code>--vulnerabilitiesreport</code>: Retrieve vulnerabilities reports.</li>
    <li><code>-p</code> or <code>--patchsreport</code>: Retrieve patch versions reports.</li>
    <li><code>-i</code> or <code>--incidentvulnerability</code>: Retrieve incident vulnerabilities reports.</li>
    <li><code>-mt</code> or <code>--mitigationtime</code>: Retrieve the mitigation time.</li>
    <li><code>-cd</code> or <code>--cleandata</code>: Clean EndpointIncidentesVulnerabilities and Vulnerabilities report</li>
  </ul>

  <p>Press Enter to execute the command.</p>

  <p>The VickyTopiaReportCLI.py script will generate the following reports:</p>

  <ul>
    <li>EndpointCountPatchs.csv</li>
    <li>EndpointIncidentesVulnerabilities.csv</li>
    <li>EndpointIncidentesVulnerabilitiesND.csv</li>
    <li>EndpointPatchs.csv</li>
    <li>Endpoints.csv</li>
    <li>EndpointsEventTask.csv</li>
    <li>EndpointsGroup.csv</li>
    <li>MitigationTime.csv</li>
    <li>Vulnerabilities.csv</li>
    <li>VulnerabilitiesND.csv</li>
  </ul>

  <p>Open Power BI and locate the Power BI file (.pbix) that corresponds to your report.</p>

  <p>In Power BI, go to the "Home" tab and click on "Edit Queries" or "Transform Data" (depending on your Power BI version) to open the Power Query Editor.</p>

  <p>In the Power Query Editor, locate each table that corresponds to the generated reports and update the directory paths to point to the cleaned versions of the reports. To do this, follow these steps for each table:</p>

  <ol>
    <li>Right-click on the table and select "Advanced Editor" to open the Advanced Editor window.</li>
    <li>In the Advanced Editor, locate the directory path that corresponds to the original report file.</li>
    <li>Update the directory path to point to the corresponding cleaned report file generated by the cleanData.py script.</li>
    <li>Click "Done" to save the changes for the table.</li>
  </ol>

  <p>Repeat steps 1 to 4 for each table that corresponds to a generated report.</p>

  <p>Save the changes in the Power Query Editor and close the editor.</p>

  <p>Run each report in Power BI in the same order as the original reports were generated to ensure data consistency and accuracy.</p>

  <p>Please ensure that all the necessary dependencies (requests for VickyTopiaReportCLI.py and pandas for cleanData.py) are installed using pip before running the respective scripts.</p>

  <p>Make sure that the file names mentioned above match the actual file names generated by the VickyTopiaReportCLI.py script.</p>

</body>
</html>